<!DOCTYPE html>
<html lang="en">
<head>
    <title>AIæ‚¦åˆ›ä»£ç åˆ†äº«å°å·¥å…·ï½œä¾¿æ·åˆ†äº«ä»£ç </title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta property="og:site_name" content="Pythonåœ¨çº¿ä»£ç ç¼–å†™ï½œAIæ‚¦åˆ›ç¼–ç¨‹ä¸€å¯¹ä¸€è¾…å¯¼">
    <link rel="icon" href="https://bornforthis.cn/favicon.ico">
    <meta name="keywords"
          content="ä»£ç , ä»£ç åˆ†äº«, åœ¨çº¿å·¥å…·, åˆ›å®¢, AIæ‚¦åˆ›, Python, Java, C++, code share, program share, ç¼–ç¨‹ä¸€å¯¹ä¸€æ•™å­¦, Javaç¼–ç¨‹ä¸€å¯¹ä¸€æ•™å­¦">
    <meta name="description" content="ä¸€ä¸ªæ–¹ä¾¿åˆ†äº«ä»£ç çš„åœ¨çº¿å°å·¥å…·ï¼Œå¯ä»¥ç”Ÿæˆå¸¦äºŒç»´ç çš„ä»£ç æˆªå›¾ï¼Œæ–¹ä¾¿åˆ†äº«ã€‚">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.18/dist/css/bootstrap-select.min.css"
          rel="stylesheet">
    <style type="text/css" media="screen">
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: #2f3129;
            overflow: hidden;
        }

        .container-fluid {
            margin: 0;
            padding: 0;
        }

        /* 2. è®© row ä½¿ç”¨ no-guttersï¼Œå»æ‰é»˜è®¤çš„å·¦å³å†…é—´è· */
        .row.no-gutters {
            margin-right: 0;
            margin-left: 0;
        }

        /* ä¹Ÿå¯å†è¦†ç›– col é»˜è®¤çš„padding */
        .col-sm-8, .col-md-4 {
            padding: 0 !important;
        }

        .ace_editor .ace_content span,
        .ace_editor .ace_content .ace_line {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace !important;
        }

        img {
            max-width: 100%;
        }

        .btn-area {
            position: relative;
            z-index: 1000;
            height: 56px;
            background-color: #2f3129;
        }

        .btn-area button {
            float: left;
            color: #fff;
            border-radius: 0;
            border-width: 0;
            height: 100%;
            width: 80px;
            /* æ–°å¢ï¼šè¿‡æ¸¡åŠ¨ç”» */
            transition: transform 0.15s ease, box-shadow 0.15s ease, filter 0.15s ease;
            will-change: transform;
        }

        /* æ‚¬åœæ—¶å¾®å¾®æŠ¬èµ·å¹¶åŠ é˜´å½±ã€å˜äº® */
        .btn-area button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            filter: brightness(1.1);
            cursor: pointer;
        }

        /* ç‚¹å‡»æ—¶æŒ‰ä¸‹æ•ˆæœ */
        .btn-area button:active {
            transform: translateY(0) scale(0.95);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            filter: brightness(0.9);
        }

        /* åŸ run æŒ‰é’®å·²ç§»é™¤ï¼Œä»…ä¿ç•™ save / open / share */
        #save {
            background-color: #6dddf2;
        }

        #open {
            background-color: #f53855;
        }

        #share {
            background-color: #a7c336;
        }

        #home {
            background-color: #ef7d62;
        }

        .help-link-container a {
            color: #fff;
        }

        .choose-container {
            color: #fff;
            padding-left: 5px;
            padding-right: 5px;
            display: flex;
            -webkit-display: -webkit-flex;
            align-items: center;
        }

        .theme-choose {
            color: #fff;
            padding-left: 5px;
            padding-right: 5px;
            display: flex;
            -webkit-display: -webkit-flex;
            align-items: center;
        }

        .code-container {
            padding-left: 0;
            padding-right: 0;
            /* è®©ç¼–è¾‘å™¨æ‰€åœ¨åˆ—å¯ä¼¸ç¼©ï¼Œå æ»¡å‰©ä½™ç©ºé—´ */
            height: calc(100vh - 56px);
            overflow: hidden;
        }

        #editor {
            /* è®© Ace Editor å æ»¡çˆ¶å®¹å™¨çš„é«˜åº¦ */
            height: 100%;
            width: 100%;
        }

        /* ========== ä¸‹é¢æ˜¯å¯¹åˆ†äº«å¼¹çª—çš„æ ·å¼é€‚é…æ”¹åŠ¨ ========== */
        /* ä¿æŒæ•´ä½“å®½åº¦åœ¨ 90%ï¼Œæœ€å¤§å®½åº¦ 900pxï¼Œä¿è¯åœ¨å¤§å±æ—¶ä¸ä¼šè¿‡å®½ï¼Œå°å±å¯è‡ªé€‚åº” */
        .modal-dialog {
            width: 90%;
            max-width: 900px;
            margin: 1.75rem auto;
        }

        /* åœ¨å°äº 768px çš„å±å¹•ä¸‹å†å¾®è°ƒï¼Œä½¿å…¶æ›´é€‚é…ç§»åŠ¨ç«¯ */
        @media (max-width: 768px) {
            .modal-dialog {
                width: 95%;
            }
        }

        /* å¼¹çª—å†…å®¹æœ€å¤§é«˜åº¦ 80vhï¼Œè¶…å‡ºéƒ¨åˆ†å¯æ»šåŠ¨ */
        .modal-content {
            max-height: 80vh;
            overflow-y: auto;
        }

        /* å¤åˆ¶æç¤ºçš„åŠ¨ç”»æ ·å¼ */
        .copy-alert {
            display: none; /* é»˜è®¤éšè—ï¼Œé€šè¿‡JSæ§åˆ¶æ˜¾ç¤º/éšè— */
            background-color: #28a745;
            color: #fff;
            padding: 8px;
            margin-top: 5px;
            border-radius: 4px;
            animation: fadeOut 2s forwards; /* 2såè‡ªåŠ¨æ·¡å‡º */
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
            }
            70% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }
    </style>

    <!-- å¦‚æœåç«¯ä¼ æ¥äº† pre_codeï¼Œå°±ç”¨å®ƒæ¥è®¾ç½®ç¼–è¾‘å™¨åˆå§‹å€¼ã€‚å¦åˆ™ä¸ºç©ºä¸² -->
    {% if pre_code %}
    <script>
        let server_pre_code = {{ pre_code|tojson }};
    </script>
    {% else %}
    <script>
        let server_pre_code = "";
    </script>
    {% endif %}

    <!-- å¦‚æœåç«¯ä¼ æ¥äº† pre_langï¼Œå°±ç”¨å®ƒæ¥è®¾ç½®è¯­è¨€é€‰æ‹©å™¨ã€‚å¦åˆ™é»˜è®¤æ˜¯ "python" -->
    {% if pre_lang %}
    <script>
        let server_pre_lang = "{{ pre_lang }}";
    </script>
    {% else %}
    <script>
        let server_pre_lang = "python";
    </script>
    {% endif %}
</head>

<body>
<div class="container-fluid">
    <div class="row">
        <!-- ä»£ç ç¼–è¾‘åŒºï¼šåªä¿ç•™ç¼–è¾‘å™¨ï¼Œä¸å†å±•ç¤ºè¾“å‡ºæ¡† -->
        <div class="col-sm-12 code-container">
            <div id="editor"></div>
        </div>
    </div>

    <!-- æŒ‰é’®åŒºåŸŸ -->
    <div class="row btn-area">
        <button id="save" onclick="save()">save</button>
        <button id="open" onclick="performClick('file-input')">open</button>
        <button id="share" onclick="share()">share</button>
        <button id="home" onclick="home()">home</button>

        <!-- ========== è¯­è¨€é€‰æ‹©å™¨ ========== -->
        <div class="choose-container" style="margin-left: 15px;">
            <span class="ml-2 mr-2">Language: </span>
            <select id="lang-selector" class="selectpicker" data-style="btn-dark" data-width="140px">
                <option value="python">Python</option>
                <option value="javascript">JavaScript</option>
                <option value="c_cpp">C/C++</option>
                <option value="java">Java</option>
                <option value="php">PHP</option>
                <option value="ruby">Ruby</option>
                <option value="golang">Go</option>
                <option value="html">HTML</option>
                <option value="css">CSS</option>
                <option value="markdown">Markdown</option>
                <!-- éœ€è¦æ›´å¤šå¯ç»§ç»­æ·»åŠ  -->
            </select>
        </div>

        <div class="choose-container theme-selector-container">
            <span class="ml-2 mr-2">Theme: </span>
            <select id="theme-selector" class="selectpicker" data-style="btn-dark" data-width="120px">
                <option value="monokai">monokai</option>
                <option value="github">github</option>
                <option value="tomorrow">tomorrow</option>
                <option value="kuroir">kuroir</option>
                <option value="twilight">twilight</option>
                <option value="vibrant_ink">vibrant_ink</option>
                <option value="xcode">xcode</option>
                <option value="textmate">textmate</option>
                <option value="terminal">terminal</option>
                <option value="solarized_dark">solarized dark</option>
                <option value="solarized_light">solarized light</option>
            </select>
        </div>
        <div class="help-link-container my-auto ml-3">
            <a id="about" href="#" data-toggle="modal" data-target="#about-modal">About</a>
        </div>
        <input id="file-input" type="file" style="position:fixed;top:-1000px;"/>
    </div>
</div>

<!-- Share Modal -->
<div class="modal fade" id="share-modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered"><!-- å¯é€‰ï¼šè®©å¼¹çª—åœ¨å‚ç›´å±…ä¸­ -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Share your code</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body text-center">
                <!-- è¿™é‡Œä¼šåŠ¨æ€ç”ŸæˆäºŒç»´ç +æœ€ç»ˆåˆæˆå›¾ -->
                <div id="qrcode" style="margin-left:auto; margin-right:auto; margin-bottom: 20px;"></div>

                <!-- åˆ†äº«é“¾æ¥æ˜¾ç¤º + å¤åˆ¶æŒ‰é’®åŒºåŸŸ -->
                <div id="share-link-div" class="text-center" style="margin-bottom:10px;">
                    <!-- ä¸‹é¢çš„ span ç”¨äºåŠ¨æ€å¡«å……åˆ†äº«é“¾æ¥ -->
                    <span id="share-link-text"
                          style="display:inline-block; margin-right:10px; color: #000; font-weight: bold;"></span>
                    <button id="copy-share-link-btn" class="btn btn-outline-primary btn-sm">å¤åˆ¶é“¾æ¥</button>
                </div>

                <!-- æç¤ºå¤åˆ¶æˆåŠŸçš„åŠ¨ç”»åŒºåŸŸ -->
                <div id="copy-alert" class="copy-alert">åˆ†äº«é“¾æ¥å·²ç»å¤åˆ¶ï¼</div>

                <p>You can save this picture or scan the QR code to share it.</p>
                <!-- åˆæˆå›¾å®¹å™¨ -->
                <div id="final-image-container" style="margin-top: 20px;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-dismiss="modal">close</button>
            </div>
        </div>
    </div>
</div>

<!-- About Modal -->
<div class="modal fade" id="about-modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered"><!-- åŒæ ·å¯ä»¥ä½¿ç”¨ modal-dialog-centered å±…ä¸­ -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">About</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body text-center">
                <h3>å…³äº CodeMark </h3>
                <hr>
                <p>ä½ å¯ä»¥åœ¨æ­¤é¡µé¢è¿›è¡Œ Python ç¼–å†™å’Œä»£ç åˆ†äº«</p>
                <p>æˆ‘ä»¬æ·»åŠ äº†å¯¹ micropipã€NumPy å’Œ Pandas çš„æ”¯æŒã€‚</p>
                <p>ç¥æ‚¨æ¢ç´¢ CodeMark æ„‰å¿«ï¼</p>
                <p>å¯¹äºæƒ³è¦åˆ¶å®šåŒ–æˆ–é«˜æ ¡åˆä½œï¼Œå¯ä»¥æ·»åŠ æ­¤å¾®ä¿¡ï¼šJiabcdefh</p>
                <img src="{{ url_for('static', filename='/images/Jiabcdefh.JPG') }}" alt="å¾®ä¿¡ï¼šJiabcdefh"
                     style="zoom:25%;">
                <br>
                <a href="https://github.com/AndersonHJB/">Github</a>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-dismiss="modal">close</button>
            </div>
        </div>
    </div>
</div>

<!-- ================== ä»£ç ç¼–è¾‘å™¨ç›¸å…³ ================== -->
<script src="{{ url_for('static', filename='js/ace/ace.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='js/ace/ext-language_tools.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='js/ace/mode-python3.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='js/ace/mode-javascript.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='js/ace/mode-c_cpp.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='js/ace/mode-java.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='js/ace/mode-php.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='js/ace/mode-ruby.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='js/ace/mode-golang.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='js/ace/mode-html.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='js/ace/mode-css.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='js/ace/mode-markdown.js') }}" type="text/javascript"></script>

<script src="{{ url_for('static', filename='js/FileSaver.min.js') }}" type="text/javascript"></script>

<!-- ç¬¬ä¸‰æ–¹åº“ -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.18/dist/js/bootstrap-select.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script type="text/javascript">
    // é˜²æ­¢æµè§ˆå™¨å‰è¿›/åé€€çš„ç¼“å­˜
    window.addEventListener("pageshow", function (event) {
        // æ–¹å¼1ï¼šæ£€æµ‹ event.persistedï¼ˆå‘½ä¸­ bfcache æ—¶ä¸º trueï¼‰
        // æ–¹å¼2ï¼šæ£€æµ‹ performance.navigation.type === 2
        if (event.persisted || (typeof window.performance != "undefined" && window.performance.navigation.type === 2)) {
            window.location.reload();
        }
    });

    // 2. é¡µé¢åŠ è½½æ—¶ï¼Œåˆå§‹åŒ– Ace ç¼–è¾‘å™¨
    window.addEventListener("load", async function () {
        ace.config.set("basePath", "static/js/ace/");
        window.editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/python");
        editor.setOptions({
            fontSize: "20pt",
            enableLiveAutocompletion: true,
            enableBasicAutocompletion: true,
            enableSnippets: true,
        });

        // Initialize bootstrap-select
        $('.selectpicker').selectpicker({
            style: 'btn-dark',
            size: 10
        });

        // Set initial theme
        $('#theme-selector').selectpicker('val', 'monokai');
        $('#lang-selector').selectpicker('val', 'python');

        // å¦‚æœåç«¯ä¼ æ¥äº† pre_langï¼Œå°±ç”¨å®ƒæ¥è®¾ç½®è¯­è¨€
        if (server_pre_lang) {
            $('#lang-selector').selectpicker('val', server_pre_lang);
            if (server_pre_lang === 'python') {
                editor.session.setMode("ace/mode/python");
            } else {
                editor.session.setMode("ace/mode/" + server_pre_lang);
            }
        }

        // å¦‚æœåç«¯ä¼ æ¥äº† pre_codeï¼Œåˆ™ç”¨å®ƒæ¥å¡«å……ç¼–è¾‘å™¨
        if (server_pre_code) {
            editor.setValue(server_pre_code, -1);
        } else {
            let message = "# -*- coding: utf-8 -*-\n# @Time    : 2024/11/16 09:07\n# @Author  : AIæ‚¦åˆ›\n# @FileName: app.py\n# @Software: CodeMark\n# @Blog    ï¼šhttps://bornforthis.cn/\n"
            editor.setValue(message + '# æ¬¢è¿ğŸ‘ä½¿ç”¨ CodeMarkâœ¨âœ¨âœ¨\n# æ­¤ç¼–è¾‘å™¨ä½ å¯ä»¥ç¼–è¾‘å’Œåˆ†äº«ä»£ç !\n# PS:æ³¨é‡Šéƒ¨åˆ†ä½ å¯ä»¥ä¿ç•™æˆ–è€…åˆ é™¤\n', -1);
        }

        // è¯­è¨€é€‰æ‹©å™¨äº‹ä»¶
        $('#lang-selector').on('changed.bs.select', function () {
            let selectedLang = $(this).val();
            // æ³¨æ„ï¼šå¯¹äº python3 åœ¨ Ace ä¸­ä¸€èˆ¬æ˜¯ "python" è¿™ä¸ª mode
            // å¦‚æœä½¿ç”¨å¤–éƒ¨ python3 æ¨¡å¼æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯ "-python3"
            // è¿™é‡Œä¸ºäº†å…¼å®¹ï¼Œä½ å¯ä»¥åšä¸€ä¸ªæ˜ å°„ã€‚è¿™é‡Œç®€å•å¤„ç†ï¼š
            if (selectedLang === 'python') {
                editor.session.setMode("ace/mode/python");
            } else {
                editor.session.setMode("ace/mode/" + selectedLang);
            }
        });

        // ä¸»é¢˜é€‰æ‹©å™¨äº‹ä»¶
        $('#theme-selector').on('changed.bs.select', function () {
            let selectedTheme = $(this).val();
            window.editor.setTheme("ace/theme/" + selectedTheme);
        });

        // Ctrl-D / Command-Dï¼šå¤åˆ¶å½“å‰è¡Œ
        editor.commands.addCommand({
            name: 'duplicateLine',
            bindKey: {win: 'Ctrl-D', mac: 'Command-D'},
            exec: function (editor) {
                editor.execCommand("copylinesdown");
            }
        });

        // ç›‘å¬ã€Œå¤åˆ¶é“¾æ¥ã€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        $('#copy-share-link-btn').on('click', function () {
            let shareLink = $('#share-link-text').text();
            copyLinkToClipboard(shareLink);
        });
    });

    // æ‰“å¼€æ–‡ä»¶
    function performClick(elemId) {
        const elem = document.getElementById(elemId);
        if (elem) { elem.click(); }
    }

    // è¯»å–æ–‡ä»¶
    function readSingleFile(e) {
        let file = e.target.files[0];
        if (!file) { return; }
        let reader = new FileReader();
        reader.onload = function (e) {
            window.editor.setValue(e.target.result, -1);
            // ç®€å•ç”¨åç¼€åˆ¤æ–­è¯­è¨€
            let autoLang = detectLanguageFromFilename(file.name);
            $('#lang-selector').selectpicker('val', autoLang);
            editor.session.setMode("ace/mode/" + autoLang);
        };
        reader.readAsText(file);
    }

    document.getElementById('file-input').addEventListener('change', readSingleFile, false);

    function detectLanguageFromFilename(filename) {
        let lowerName = filename.toLowerCase();
        if (lowerName.endsWith(".py")) return "python";
        if (lowerName.endsWith(".js")) return "javascript";
        if (lowerName.endsWith(".c") || lowerName.endsWith(".cpp") || lowerName.endsWith(".h")) return "c_cpp";
        if (lowerName.endsWith(".java")) return "java";
        if (lowerName.endsWith(".php")) return "php";
        if (lowerName.endsWith(".rb")) return "ruby";
        if (lowerName.endsWith(".go")) return "golang";
        if (lowerName.endsWith(".html")) return "html";
        if (lowerName.endsWith(".css")) return "css";
        if (lowerName.endsWith(".md")) return "markdown";
        // éƒ½ä¸ç¬¦åˆæ—¶ï¼Œé»˜è®¤è¿”å› python
        return "python";
    }

    // å›åˆ°é¦–é¡µ
    function home() {
        window.location.href = "/";
    }

    // ä¿å­˜ä¸ºæ–‡ä»¶
    function save() {
        let code = window.editor.getValue();
        // è¿™é‡Œå¯ä»¥æ ¹æ®å½“å‰ mode æ¥å†³å®šåç¼€ï¼Œç¤ºä¾‹é‡Œç®€å•åˆ¤æ–­
        let langVal = $('#lang-selector').val();
        let fileExt = ".txt";
        switch (langVal) {
            case "python": fileExt = ".py"; break;
            case "javascript": fileExt = ".js"; break;
            case "c_cpp": fileExt = ".cpp"; break;
            case "java": fileExt = ".java"; break;
            case "php": fileExt = ".php"; break;
            case "ruby": fileExt = ".rb"; break;
            case "golang": fileExt = ".go"; break;
            case "html": fileExt = ".html"; break;
            case "css": fileExt = ".css"; break;
            case "markdown": fileExt = ".md"; break;
        }
        let blob = new Blob([code], {type: "text/plain;charset=utf-8"});
        saveAs(blob, "bornforthis_code" + fileExt);
    }

    // åˆ†äº«åŠŸèƒ½ï¼šä¸Šä¼ ä»£ç åˆ°åç«¯ï¼Œè¿”å›ä¸€ä¸ªå¯åˆ†äº«çš„é“¾æ¥
    function share() {
        let code = window.editor.getValue();
        // è¿™é‡Œå¤šä¼ ä¸€ä¸ª languageï¼Œæ–¹ä¾¿åç«¯å­˜å‚¨
        let langVal = $('#lang-selector').val();
        $.ajax({
            type: 'post',
            url: '/upload_code',
            dataType: 'json',
            data: {
                code: code,
                language: langVal,
                template: 'sharecode'   // å‘Šè¯‰åç«¯æ­¤åˆ†äº«æ¥è‡ª sharecode æ¨¡æ¿
            },
            success: function (d) {
                // åç«¯è¿”å› share_linkï¼Œä¾‹å¦‚ http://127.0.0.1:5000/share/xxxx
                let shareLink = d.share_link;

                // 1. ç”ŸæˆäºŒç»´ç 
                $('#qrcode').empty();
                $('#qrcode').qrcode({
                    text: shareLink,
                    width: 200,
                    height: 200
                });

                // 2. æ›´æ–°å¼¹çª—æ ‡é¢˜ä¸­çš„å¯ç‚¹å‡»é“¾æ¥
                $('.modal-title').html(
                    'Code linkï¼š<a href="' + shareLink + '" target="_blank">' + shareLink + '</a>'
                );

                // 2.1 å°†åˆ†äº«é“¾æ¥å¡«å…¥ span æ–‡æœ¬ï¼Œä¾›æ‰‹åŠ¨å¤åˆ¶
                $('#share-link-text').text(shareLink);

                // 3. åˆæˆäºŒç»´ç ä¸ç¼–è¾‘å™¨æˆªå›¾
                let qrcodeCanvas = $('#qrcode canvas')[0];
                let qrcode_src = qrcodeCanvas.toDataURL('image/png');

                let existingFinalImageContainer = document.getElementById("final-image-container");
                if (existingFinalImageContainer) {
                    existingFinalImageContainer.innerHTML = "";
                }

                // æˆªå–ç¼–è¾‘å™¨åŒºåŸŸï¼Œå¹¶å°†äºŒç»´ç ç»˜åˆ¶åˆ°æˆªå›¾å³ä¸Šè§’
                html2canvas(document.querySelector("#editor")).then(canvas => {
                    let ctx = canvas.getContext('2d');
                    let img = new Image();
                    img.src = qrcode_src;
                    img.onload = function () {
                        // åœ¨ç¼–è¾‘å™¨æˆªå›¾ä¸Šå åŠ äºŒç»´ç ï¼Œç¼©å°åˆ° 120x120
                        let qrSize = 120;
                        ctx.drawImage(img, canvas.width - qrSize - 10, 10, qrSize, qrSize);

                        // æ˜¾ç¤ºåˆæˆåçš„æœ€ç»ˆå›¾ç‰‡
                        let finalImgElement = document.createElement("img");
                        finalImgElement.src = canvas.toDataURL('image/png');
                        finalImgElement.style.maxWidth = "90%";
                        existingFinalImageContainer.appendChild(finalImgElement);
                    };
                });

                // 4. è‡ªåŠ¨å¤åˆ¶åˆ†äº«é“¾æ¥å¹¶æ˜¾ç¤ºæç¤º
                copyLinkToClipboard(shareLink);

                // 5. æ˜¾ç¤ºåˆ†äº«å¼¹çª—
                $('#share-modal').modal('show');
            }
        });
    }

    // å°†é“¾æ¥å¤åˆ¶åˆ°å‰ªè´´æ¿å¹¶æ˜¾ç¤ºåŠ¨ç”»æç¤º
    function copyLinkToClipboard(link) {
        // è°ƒç”¨æµè§ˆå™¨çš„ Clipboard API
        navigator.clipboard.writeText(link).then(() => {
            let alertBox = document.getElementById("copy-alert");
            // æ¯æ¬¡å¤åˆ¶æ—¶éƒ½é‡ç½®ä¸€ä¸‹åŠ¨ç”»
            alertBox.style.display = "block";
            alertBox.style.animation = "none";
            // è§¦å‘å›æµï¼Œè®©ä¸Šä¸€æ¬¡åŠ¨ç”»è¢«ç§»é™¤åé‡æ–°å¼€å§‹
            void alertBox.offsetWidth;
            alertBox.style.animation = null;
        });
    }
</script>
</body>
</html>